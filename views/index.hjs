<!DOCTYPE html>
<html>
  <head>
    <title>{{ title }}</title>
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <link rel='stylesheet' href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  </head>
  <body>

    <nav class="navbar navbar-default navbar-fixed-top">
  <div class="container-fluid">

    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="#">{{title}}</a>
    </div>

    <div class="collapse navbar-collapse" id="navbar">
      <ul class="nav navbar-nav">
        {{#links}}
        <li><a href="{{url}}">{{name}}</a></li>
        {{/links}}
      </ul>
    </div>
  </div>
</nav>



    <div class="col-md-12">
<br><br>
      <div class="panel panel-default">
        <br>

    <div class="container-fluid">
      <h4><i>Main &#8594; Matappen</i></h4>
      <div class="jumbotron">
        <div class="container-fluid">
        <br><p>Matappen er her!</p><br>
        <h4>Her finner du ulike kategorier med Matprodukter.</h4>
          <input type="text" id="search" class="form-control" placeholder="SÃ¸k her">
        </div>

        <datalist id="datalist">

        </datalist>

        <br>
        <div class="panel panel-success">
            <ul class="list-group" id="liste">
              <!-- this is where the database items enters the realm! -->
            </ul>
        </div>



      </div>
      </div>
    </div>
  </body>

  <script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>

  <script type="text/javascript">

  var socket = io('http://localhost:8087');


      $(document).ready(function(){

        var i = 0;
        socket.on('sendData', function(data){

            console.log(i);
            var type = data.name;

            var text =  type + " ";
            $('<li/>', { 'name':data.type, 'class':'list-group-item','id':'li' + i}).appendTo('#liste');
            $('<h2/>', {'text':text, 'align': 'center', 'id':'lbl' + i}).appendTo('#li' + i);
            $('<span/>', {'text':data.count, 'class':'badge', 'style':'margin:0;'}).appendTo('#lbl' + i);


            $('#liste').on('click', '#li' +  i, function(){
              var name = $(this).attr('name');
              $("#liste li").parent().find('li').removeClass("active");
              $(this).addClass("active");

              $.ajax({
                url: '/getProdukterFrom'
              });
            });

            i++;
        });

        $.ajax({
          url: '/getProdukter',
          type: 'POST',
          contentType: 'application/json; charset=utf-8',
          async: true,
          success: function(datas){

          }
        });

        socket.connect();


      });

      $('#search').keypress(function(e){
        var search = $('#search');

        $.ajax({
          url: '/getProdukterFromSearch',
          type: 'POST',
          dataType: 'json',
          data: JSON.stringify({name: search.val()}),
          contentType: 'application/json; charset=utf-8',
          async: false,
          success: function(data){
            $('#liste').empty();
            for(var i = 0; i<data.length; i++){

              var name = data[i].name;
              var price = data[i].price;
              var type = data[i].type;

              var text = '<h4>' + name + '</h4><i>Pris: ' + price + '<br>' + type +  '</i>';

              $('<li/>', { 'name':name, 'html':text, 'class':'list-group-item','id':'li' + i}).appendTo('#liste');

              $('#liste').on('click', '#li' +  i, function(){
                var name = $(this).attr('name');
                $("#liste li").parent().find('li').removeClass("active");
                $(this).addClass("active");
              });

            }
          }

        });
      });


  </script>
</html>
